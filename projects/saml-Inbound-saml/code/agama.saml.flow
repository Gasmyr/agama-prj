Flow agama.saml
     Basepath ""
     Timeout 500 seconds
     Configs kcConf
// Calling SAML service
Log "@info Calling SAML service"
// Log kcConf properties
Log "@info " kcConf.serverUrl kcConf.realm kcConf.clientId
// Create instance of SamlService
samlService | ex = Call org.gluu.agama.saml.service.SamlService#new kcConf.serverUrl  kcConf.realm  kcConf.clientId  kcConf.clientSecret  kcConf.grantType  kcConf.scope  kcConf.username  kcConf.password  kcConf.spMetadataUrl  kcConf.tokenUrl  kcConf.idpUrl kcConf.extIDPTokenUrl
// Log samlService instance
Log "@info " samlService
// Get All IDP Details
idpMap | ex = Call samlService getIdps 
// Log IDP Map
Log "@info " idpMap
// Display SAML IDP Discovery Page
extIdpData = RRF "saml-idp-discovery.ftlh" idpMap
// Log extIdpData.extIdpRedirectUrl
Log "@info " extIdpData.idp
extIDPUrl = Call samlService#getIdpDetails extIdpData.idp
// Redirect to External IDP 
extIdpResponse = RFAC https://pujavs-advanced-ewe.gluu.info/kc/realms/jans/protocol/openid-connect/auth?client_id=jans-307f57ee-8978-4426-8405-137e64bc4754&response_type=code&kc_idp_hint=busy-starfish.gluu.info
// Log external IDP result
Log "@info " extIdpResponse
it_fjxis = undefined
Finish it_fjxis